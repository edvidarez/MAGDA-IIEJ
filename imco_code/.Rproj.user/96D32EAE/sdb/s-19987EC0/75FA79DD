{
    "collab_server" : "",
    "contents" : "# Diego Villamil, OPI\n# CDMX, 15 de diciembre de 2016\n\nlibrary(ggrepel)\nlibrary(RColorBrewer)\n\nfilter <- dplyr::filter\n\n# Los datos de luces llegan a variar con QGIS. \n# USAR_REFERENCIA para utilizar el dato original.\nusar_referencia <- TRUE\n\npibe_14 <- read_csv(\"../data/bie/processed/pibe.csv\") %>% \n  filter(año == \"2014-12-01\")\n\nif (usar_referencia) {\n  muns_acteco <- read_csv(\"../data/referencias/mun_luces_175.csv\",\n        col_types = \"ccdddddd\") %>% \n    mutate(CVEENT = CVEMUN %>% str_sub(1, 2)) %>% \n    left_join(by=\"CVEENT\", \n        pibe_14 %>% select(CVEENT, Estado, pibe)) %>% \n    group_by(CVEENT, Estado) %>% \n    mutate(ae_175 = pibe*x175_loc/sum(x175_loc)) %>%\n    ungroup \n} else {\n  muns_acteco <- read_csv(\"../data/viirs/processed/mun_luces_175.csv\",\n        col_types = \"ccdddd\") %>% \n    mutate(CVEENT = CVEMUN %>% str_sub(1, 2)) %>% \n    left_join(by=\"CVEENT\", \n        pibe_14 %>% select(CVEENT, Estado, pibe)) %>% \n    group_by(CVEENT, Estado) %>% \n    mutate(ae_175 = pibe*x175_loc/sum(x175_loc)) %>%\n    ungroup \n}\n\n\nwrite_csv(muns_acteco %>% select(-pibe, -CVEENT), \n  \"../data/resultados/acteco/por_municipio.csv\")\n\n\n## Gráfica de Luminosidad vs, PIBE, juntando ZMVM\n\nedo_acteco <- muns_acteco %>% \n  select(CVEMUN, x175_loc, CVEENT, Estado, pibe) %>% \n  group_by(CVEENT, Estado) %>% \n  summarize(x175_loc = sum(x175_loc), \n            pibe = max(pibe)) \n\nedo_zmvm <- edo_acteco %>%\n  mutate(zmvm = ifelse(str_detect(Estado, \"México\"), \n      \"ZMVM\", \"no_ZMVM\")) %>% \n  group_by(zmvm) %>% \n  summarize_at(vars(x175_loc, pibe), funs(sum)) %>% \n  filter(zmvm == \"ZMVM\") %>% rename(Estado = zmvm) %>% \n  mutate(CVEENT = \"09_15\")\n\nedo_acteco_ <- edo_acteco %>% \n  filter(!str_detect(Estado, \"México\")) %>% \n  bind_rows(edo_zmvm)\n\n \ngg_lineup <- edo_acteco_ %>% \n  ggplot(aes(x175_loc, pibe, color = Estado)) + \n    geom_point() + \n    geom_smooth(method = \"lm\", color = \"cornflowerblue\", se=FALSE) +\n    scale_x_log10(\"Luminosidad (escala log)\", \n        labels = . %>% divide_by(1e3)) +\n    scale_y_log10(\"PIBE (escala log)\", labels = . %>% divide_by(1e3)) + \n    scale_color_manual(values = brewer.pal(8, \"Dark2\") %>% rep(4)) +\n    geom_text_repel(aes(label = Estado)) + \n    theme(legend.position = \"none\")\nprint(gg_lineup)\n\nggsave(plot = gg_lineup, \n    \"../visualization/figures/scatter_luces_log.png\", \n    width = 16, height = 9, dpi = 100)\n\nmuns_metro <- read_csv(\"../data/referencias\" %>% file.path(\n      \"zonas_metro_estado_ok.csv\")) %>% \n  mutate(CVEMET = CVEMET %>% str_pad(3, \"left\", \"0\"),\n      CVEENT = CVEENT %>% str_pad(2, \"left\", \"0\"),\n      CVEMUN = CVEMUN %>% str_pad(5, \"left\", \"0\")) %>% \n  select(CVEMET, CVEENT, CVEMUN, zona_metro = nombre_corto)\n\nacteco_metro <- muns_acteco %>% select(-CVEENT, -Estado) %>% \n  right_join(muns_metro, by=\"CVEMUN\") %>% \n  group_by(CVEENT, CVEMET, zona_metro) %>% \n  summarize_at(.funs = funs(sum), \n    .cols = vars(ae_175, area, area_loc))\n\nwrite_csv(acteco_metro, \n  \"../data/resultados/acteco/por_zonas_metro.csv\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "created" : 1539037813104.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "874760297",
    "id" : "75FA79DD",
    "lastKnownWriteTime" : 1539032711,
    "last_content_update" : 1539032711,
    "path" : "~/programming/pap/otoño/indice-de-actividad-economica/imco_code/3_calcular_niveles_luces.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}