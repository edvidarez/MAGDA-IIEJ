{
    "collab_server" : "",
    "contents" : "# Diego Villamil, OPI\n# CDMX, 13 de diciembre de 2016\n# modificado 4 de enero de 2017\n\n# Este script es para hacer sanity checks de las estimaciones de \n# índice metropolitano. \n# Para cada estado, comparar:  \n#   PIBE\n#   ITAEE rescalado\n#   act_eco del estado\n#   act_eco de las ciudades del estado\n\n\nlibrary(RColorBrewer)\n\nmetros_ref <- read_csv(\"zonas_metro_estado_ok.csv\" %>% \n    file.path(\"../data/referencias\", .)) %>% \n    select(CVEMET, zona_metro = nombre_corto, CVEMUN, CVEENT)\n\nmetros_ae <- read_csv(\"../data/resultados/integrado\" %>% file.path(\n    \"selecto_zm_edo_martes.csv\"), col_types = \"cccDnn\") %>% \n  select(trimestre, CVEENT, CVEMET, zona_metro, acteco)\n\npibe <- read_csv(\"../data/bie/processed/pibe.csv\") %>% \n  rename(trimestre = año)\nitaee <- read_csv(\"../data/bie/processed/itaee.csv\") %>% \n  select(trimestre = fecha, Estado, CVEENT, itaee = original)\n  \n\n\nestado_ae <- read_csv(\"selecto_estado.csv\" %>% \n    file.path(\"../data/resultados/integrado/\", .)) %>%\n  select(trimestre, Estado, CVEENT, acteco)\n\njunta_columnas <- c(\"trimestre\", \"CVEENT\", \"Estado\")\nestado_totales_ <- pibe %>% \n  right_join(itaee, by = junta_columnas) %>% \n  inner_join(estado_ae, by = junta_columnas)\n\nestado_totales <- estado_totales_ %>% \n  inner_join(by = c(\"trimestre\", \"CVEENT\"), metros_ae %>% \n      group_by(trimestre, CVEENT) %>% \n      summarize(por_metros = sum(acteco, na.rm=T))) %>% \n  # inner_join(by = c(\"trimestre\", \"CVEENT\"), muns_ae %>% \n  #     mutate(CVEENT = str_sub(CVEMUN, 1, 2)) %>% \n  #     group_by(trimestre, CVEENT) %>% \n  #     summarize(por_muns = sum(acteco, na.rm=T))) %>% \n  group_by(CVEENT, Estado) %>% \n  mutate(es_2014 = (trimestre == \"2014-12-01\"), \n      itaee_al_pib = itaee/itaee[es_2014]*pibe[es_2014])\n  \n\ngg_sanity <- estado_totales %>% \n    gather(\"índice\", \"valor\", factor_key = TRUE, \n        pibe, itaee_al_pib, por_metros) %>% \n    filter(!is.na(valor)) %>% \n  ggplot(aes(trimestre, valor, color = índice)) + \n    facet_wrap( ~ Estado, scales = \"free_y\", nrow = 5) + \n    geom_line() + \n    ggtitle(\"Actividad Económica\") +\n    scale_x_date(\"\") +\n    scale_y_continuous(\"\", labels = . %>% divide_by(1e3)) + \n  # coord_cartesian(xlim = c(\"2013-10-01\", \"2015-10-01\") %>% \n  #     as.Date) +\n    scale_color_brewer(palette = \"Dark2\") +\n    # expand_limits(y = 0) +\n    theme(legend.position = c(5/7, 1/10))\nprint(gg_sanity)\nggsave(plot = gg_sanity, \n  \"../visualization/comprobación_modelo_m5.png\",\n  width = 16, height = 9, dpi = 100)\n\n\n## Ésta no está efectiva. \n\n# data_met <- read_csv(\"../data/conapo/conapo_municipio.csv\") %>% \n#   select(CVEMUN = cvegeo, fecha, total) %>% \n#   filter(fecha <= \"2016-01-01\") %>% \n#   mutate(trimestre = fecha %>% ymd %>% add(months(11))) %>% \n#   right_join(metros_ref %>% select(-CVEENT), by = \"CVEMUN\") %>% \n#   group_by(CVEMET, zona_metro, trimestre) %>% \n#   summarize(poblacion = sum(total, na.rm=T)) %>% ungroup %>% \n#   mutate(CVEMET = str_pad(CVEMET, 3, \"left\", \"0\")) %>% \n#   inner_join(metros_ae, \n#       by=c(\"trimestre\", \"CVEMET\", \"zona_metro\")) %>% \n#   group_by(CVEMET, zona_metro) %>% arrange(trimestre) %>% \n#   mutate(acteco_crec = acteco/lag(acteco) - 1, \n#       acteco_percap  = acteco/poblacion)\n# gg_acteco_vars <- data_met %>% \n#   filter(trimestre == \"2015-12-01\") %>% \n#   ggplot(aes(acteco_percap, acteco_crec, color = zona_metro)) + \n#     geom_point() +\n#     # geom_text_repel(aes(label = zona_metro)) + \n#     scale_color_manual(values = brewer.pal(8, \"Dark2\") %>% rep(10)) +\n#     theme(legend.position = \"none\")\n# \n# print(gg_acteco_vars)\n# \n# ggsave(plot = gg_acteco_vars, \n#   \"../visualization/figures/acteco_transform_.png\", \n#   width = 16, height = 9, dpi = 100)\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "created" : 1540045530953.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "717988813",
    "id" : "C7E2E169",
    "lastKnownWriteTime" : 1539032711,
    "last_content_update" : 1539032711,
    "path" : "~/programming/pap/otoño/indice-de-actividad-economica/imco_code/5_comprobar_porcentajes.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}